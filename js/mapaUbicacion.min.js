var destinoLatLng=L.latLng(40.320930,-3.870172);var mimapa=L.map('mapa').setView([40.320930,-3.870172],13);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(mimapa);var marcador=L.marker([40.320930,-3.870172]).addTo(mimapa);marcador.bindPopup(`<p><b>COFFEE-SHOP</b><p><p>C/Xxxxxxxxx, nº xx, xxxxxxxx(Madrid)</p><p>+34 91-000-00-00 // 600-00-00-00</p><p>contacto-coffee-shop@xxxx.com</p><p>Horario: De Lunes a Viernes: de 9:00 a 18:00h.</p>`);mimapa.on('load',function(){marcador.openOn(mimapa)});var circulo=L.circle([40.320930,-3.870172],{color:'#006b73',fillColor:'#734200',fillOpacity:0.6,radius:80}).addTo(mimapa);mimapa.locate({setView:!0,maxZoom:16,watch:!1});var userMarker;var userCircle;var controlRuta=null;mimapa.on('locationfound',function(e){var ubicacionUsuario=e.latlng;if(userMarker){mimapa.removeLayer(userMarker);mimapa.removeLayer(userCircle)}
if(controlRuta){mimapa.removeControl(controlRuta)}
userMarker=L.marker(ubicacionUsuario).addTo(mimapa).bindPopup("¡Tu ubicación actual!");userCircle=L.circle(ubicacionUsuario,{color:'blue',fillColor:'#0c0539ff',fillOpacity:0.5,radius:e.accuracy/20}).addTo(mimapa);controlRuta=L.Routing.control({waypoints:[ubicacionUsuario,destinoLatLng],routeWhileDragging:!1,language:'es',show:!0,collapsible:!1,createMarker:function(){return null}}).addTo(mimapa)});mimapa.on('locationerror',function(e){alert("No se pudo obtener tu ubicación para calcular la ruta: "+e.message+"\nPor favor, asegúrate de aceptar los permisos de geolocalización para poder mostrarte la ruta.");marcador.openOn(mimapa)});mimapa.on("click",function(e){var pixelPosition=e.layerPoint;var latLng=e.latlng;alert("Position Pixel = "+pixelPosition+"\n LatLng = "+latLng)})